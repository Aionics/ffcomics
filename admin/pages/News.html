<div class="container" data-bind="with: m_news">
    <div class="row bb">
        <div class="col s12">
            <h5>Новая нвоость:</h5>
        </div>
    </div>
    <div class="row">
        <div class="col s6">
            <form>
                <div class="input-field">
                    <input id="news-title" type="text" data-bind="textInput: title">
                    <label for="news-title">Заголовок</label>
                </div>
                <div class="input-field">
                    <input id="news-lead" type="text" data-bind="textInput: lead">
                    <label for="news-lead">Лид</label>
                </div>
            </form>
        </div>
    </div>

    <!-- ko foreach: {data: items, as: 'item'} -->
    <div class="row">
        <div class="col s12" data-bind="template: {name: item.name(), data: item}">
        </div>
    </div>
    <!-- /ko -->

    <hr>
    <div class="row">
        <div class="col s4">
            <a class="waves-effect waves-light btn" data-bind="click: postNews.bind($data)">Запостить</a>
        </div>
        <div class="col s8">

            <a class="btn-floating btn-medium waves-effect waves-light tooltipped" data-bind="click: function() {
                m_news.items.push( new VariationCover() )
            }" data-position="bottom" data-delay="50" data-tooltip="вариативные обложки">
                <i class="material-icons">view_column</i>
            </a>
            <a class="btn-floating btn-medium waves-effect waves-light tooltipped" data-bind="click: function() {
                m_news.items.push( new RichText() )
            }" data-position="bottom" data-delay="50" data-tooltip="текст">
                <i class="material-icons">subject</i>
            </a>
            <a class="btn-floating btn-medium waves-effect waves-light tooltipped" data-bind="click: function() {
                m_news.items.push( new YouTube() )
            }" data-position="bottom" data-delay="50" data-tooltip="видяшка с ютуба">
                <i class="material-icons">videocam</i>
            </a>

        </div>
    </div>

    <script type="text/html" id="variational-covers">
        <div class="relative-wrapper news-item">
            <div class="options">
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: function() {
                    $(inputField()).click()
                }">
                    <i class="material-icons">mode_edit</i>
                </a>
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: m_news.promoteItem.bind($data)">
                    <i class="material-icons" data-bind="text: promoted() ? 'visibility' : 'visibility_off'"></i>
                </a>
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: m_news.removeItem.bind($data)">
                    <i class="material-icons">delete</i>
                </a>
            </div>
            <div class="variational-covers">
                <input type="file" multiple="multiple" name="covers[]" accept="image/*" class="fileInput" style="display:none" data-bind="files: {inputField: inputField, images: images}"/>

                <!-- ko if: images().length == 0 -->
                <a class="waves-effect waves-light btn-large absolute-centered" data-bind="click: function() {
                    $(inputField()).click()
                }">Выбери изображения</a>
                <!-- /ko -->

                <!-- ko ifnot: images().length == 0 -->
                    <!-- ko foreach: {data: images, as: 'img'} -->
                        <div class="img-wrapper" data-bind="
                            style:{
                                width: $index()==0 || $index()==$parent.images().length-1 ? 100/$parent.images().length-1+5+'%' : 100/$parent.images().length+'%',
                                left: $index()==0 || $index()==$parent.images().length-1 ? (100/$parent.images().length)*($index())-3+4*$index()/($parent.images().length-1)+'%' : (100/$parent.images().length)*($index())+1+'%'
                            },
                            click: function () {
                                m_news.selectedCover(img)
                                $('#modal-covers').modal('open');
                            }">
                            <div class="img" data-bind="
                                style:{
                                    backgroundImage: 'url(' + img.src + ')'}">
                            </div>
                        </div>
                    <!-- /ko -->
                <!-- /ko -->
            </div>
        </div>
    </script>

    <script type="text/html" id="rich-text">
        <div class="relative-wrapper news-item">
            <div class="options">
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: m_news.promoteItem.bind($data)">
                    <i class="material-icons" data-bind="text: promoted() ? 'visibility' : 'visibility_off'"></i>
                </a>
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: m_news.removeItem.bind($data)">
                    <i class="material-icons">delete</i>
                </a>
            </div>
            <div class="richText" data-bind="richText: textField"></div>
        </div>
    </script>

    <script type="text/html" id="youtube">
        <div class="relative-wrapper news-item">
            <div class="options">
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: m_news.promoteItem.bind($data)">
                    <i class="material-icons" data-bind="text: promoted() ? 'visibility' : 'visibility_off'"></i>
                </a>
                <a class="btn-floating btn-medium waves-effect waves-light btn-right" data-bind="click: m_news.removeItem.bind($data)">
                    <i class="material-icons">delete</i>
                </a>
            </div>
            <!-- ko if: src && src().indexOf('www.youtube.com') !== -1 -->
                <iframe frameborder="0" allowfullscreen data-bind="attr: {src: src}"></iframe>
            <!-- /ko -->
            <!-- ko ifnot: src && src().indexOf('www.youtube.com') !== -1 -->
            <div class=row>
                <div class="col s6 offset-s3">
                    <input type="text" data-bind="textInput: src">
                    <label>ссылка</label>
                </div>
            </div>
            <!-- /ko -->
        </div>
    </script>

    <div id="modal-covers" class="modal" data-bind="with: selectedCover">
        <div class="modal-content">
            <h5>Информация об обложке</h5>
            <input id="news-cover-verse" type="text">
            <label>Вселенная</label>
            <input id="news-cover-name" type="text">
            <label>Название и номер</label>
            <input id="news-cover-author" type="text">
            <label>Автор</label>
            <input id="news-cover-comment" type="text">
            <label>Комментарий</label>
            <input id="news-cover-source" type="text">
            <label>Источник</label>
        </div>
        <div class="modal-footer">
            <a class="waves-effect waves-light btn" data-bind="click: function($data) {
                this.verse = $('#news-cover-verse').val();
                this.name = $('#news-cover-name').val();
                this.author = $('#news-cover-author').val();
                this.comment = $('#news-cover-comment').val();
                this.source = $('#news-cover-source').val();
                $('#modal-covers').modal('close');
            }">ok</a>
        </div>
    </div>

</div>
